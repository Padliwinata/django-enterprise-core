<!--
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# File: group.html
# Project: django-panel-core
# File Created: Wednesday, 22nd August 2018 12:52:24 am
# 
# Author: Arif Dzikrullah
#         ardzix@hotmail.com>
#         https://github.com/ardzix/>
# 
# Last Modified: Wednesday, 22nd August 2018 12:52:24 am
# Modified By: arifdzikrullah (ardzix@hotmail.com>)
# 
# Hand-crafted & Made with Love
# Copyright - 2018 Ardz Co, https://github.com/ardzix/django-panel-core
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-->

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/af-2.3.0/b-1.5.2/b-flash-1.5.2/b-print-1.5.2/r-2.2.2/rg-1.0.3/rr-1.2.4/datatables.min.css"/>

<style>
    .error {
        color:red;
    }
    .info {
        color:blue;
    }
    .success {
        color:green;
    }
    .warning {
        color:yellow;
    }
</style>
{% for message in messages %}
    <div class="{{message.tags}}">
        <!-- START card -->
        
            <div>
            {% autoescape off %}
            <p><strong>{{message.tags|upper}}: </strong>{{ message }}</p>
            {% endautoescape %}
            </div>

        <!-- END card -->
    </div>
{% endfor %}

<button type="button" onclick="back()">
    <span><i class="fa fa-pencil"></i>&nbsp;Back</span>
</button>
<button type="button" onclick="create_new()">
    <span><i class="fa fa-pencil"></i>&nbsp;Add New</span>
</button>
<input type="text" id="search-table" placeholder="Search">

<table class="datatable" id="mainTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Display Name</th>
            <th>Code Name</th>
            <th>Content Type</th>
            <th></th>
        </tr>
    </thead>
</table>
 
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.18/af-2.3.0/b-1.5.2/b-flash-1.5.2/b-print-1.5.2/r-2.2.2/rg-1.0.3/rr-1.2.4/datatables.min.js"></script>

<script>

    $(function () {
        var table = $('#mainTable');

        var settings = {
            "sDom": "<t><'row'<p i>>",
            "destroy": true,
            "scrollCollapse": true,
            "oLanguage": {
                "sLengthMenu": "_MENU_ ",
                "sInfo": "Showing <b>_START_ to _END_</b> of _TOTAL_ entries"
            },
            "iDisplayLength": 20,
            "processing": true,
            "serverSide": true,
            "columns": [
              null,
              null,
              null,
              {'searchable':false, 'sortable':false},
              {'searchable':false, 'sortable':false},

            ],
           "ajax": ""

        };

        table.dataTable(settings);

        // search box for table
        $('#search-table').keypress(function(e) {
            var key = e.which;
            if(key == 13)  // the enter key code
            {
                table.fnFilter($(this).val());
            }
        });
    });


    // Script for deleting data
    function delete_data(id){
        var r = confirm("You are about to delete this data.. Click OK if you sure!!");
        if (r == true) {
            $.ajax({
                url: window.location.href,
                data: { id: id} ,
                type: 'DELETE',
                success: function(result) {
                    location.reload();
                }
            });
        } else {

        }
    }

    function back(){
        document.location="{% url 'superuser:index' %}"
    }

    function create_new(){
        var url = window.location.href+"form/"
        url = url.replace("#", "")
        url = url.replace("_=_", "")
        window.location.replace(url)
    }

    function edit_data(id){
        
    }

    var touchtime = 0;
    var second_touch = false;
    var can_be_clicked = false;
    $(document).on("click", ".datatable-edit-button", function(){
        var id = $(this).attr("id").split("-")[1]
        var url = window.location.href+"form/?edit="+id
        url = url.replace("#", "")
        url = url.replace("_=_", "")
        if (touchtime!=0){
            touchtime = new Date().getTime();
            if(((new Date().getTime())-touchtime) < 500) {
                second_touch = true;        
            }
        }

        if(second_touch && touchtime){
            window.open(url, '_blank');
            can_be_clicked = false        
        }else{
            can_be_clicked = true        
        }

        touchtime = new Date().getTime();        
        setTimeout(function(){
            touchtime = 0;
            second_touch = false
            if (can_be_clicked){
                window.location.replace(url)    
            }
        }, 500);
    })


    // Script to include csrf on post method
    function csrfSafeMethod(method) {

        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $.ajaxSetup({
        crossDomain: false, // obviates need for sameOrigin test
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type)) {
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        }
    });

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

</script>